<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Pago | Q10</title>

  <!-- FlexPayment -->
  <script src="https://alignet-flex-demo.s3.amazonaws.com/flex-payment-forms.min.js"></script>
  <link rel="stylesheet" type="text/css" href="https://alignet-flex-demo.s3.amazonaws.com/main-flex-payment-forms.css" />

  <!-- Tipografia moderna -->
  <link href="https://fonts.googleapis.com/css2?family=Sora:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      /* Paleta Q10 */
      --naranja:#F39C12;
      --naranja-osc:#D9820F;
      --amarillo:#F5B84C;
      --amarillo-claro:#FFE0A8;
      --gris-900:#2E2E2E;
      --gris-600:#7C7C7C;
      --gris-200:#E6E6E6;
      --gris-100:#F4F4F4;
      --blanco:#ffffff;
      --fondo:#F7F7F7;

      --radius-lg:16px;
      --radius-xl:22px;
      --shadow-1:0 6px 18px rgba(0,0,0,.06);
      --shadow-2:0 14px 34px rgba(0,0,0,.12);
      --timing:.25s cubic-bezier(.2,.7,.2,1);
    }

    *{margin:0;padding:0;box-sizing:border-box}
    html,body{height:100%}
    body{
      font-family: "Sora", "Trebuchet MS", sans-serif;
      background:
        radial-gradient(900px 520px at 12% 8%, #ffffff 0%, #f2f2f2 35%, var(--fondo) 70%),
        repeating-linear-gradient(135deg, rgba(0,0,0,.03), rgba(0,0,0,.03) 8px, rgba(0,0,0,0) 8px, rgba(0,0,0,0) 16px);
      color:var(--gris-900);
      -webkit-font-smoothing:antialiased;
    }

    /* Header */
    header{
      background:var(--blanco);
      height:72px;
      display:flex;
      align-items:center;
      padding:0 20px;
      box-shadow:0 1px 0 var(--gris-200);
      cursor:pointer;
    }
    header img{height:44px; width:auto}

    /* Layout asimétrico */
    .stage{
      display:grid;
      grid-template-columns: 430px 1fr;
      min-height:calc(100vh - 72px);
      position:relative;
    }
    .stage::before{
      content:"";
      position:absolute;
      inset:0 38% 0 0;
      background: linear-gradient(150deg, var(--gris-900), var(--naranja));
      clip-path: polygon(0 0, 100% 0, 86% 100%, 0% 100%);
      z-index:0;
    }

    /* Caja opciones */
    .options{
      grid-column:1/2;
      align-self:center;
      margin:40px;
      background:var(--blanco);
      border-radius:var(--radius-xl);
      box-shadow:var(--shadow-2);
      padding:28px;
      width:min(380px, 90%);
      z-index:2;
      position:relative;
    }
    .options h2{
      font-size:22px;
      font-weight:700;
      color:var(--gris-900);
      margin-bottom:6px;
    }
    .sub{font-size:13px; color:var(--gris-600); margin-bottom:18px}

    /* Botones */
    .stack{display:flex; flex-direction:column; gap:14px}
    .payment-option{
      --w:100%;
      width:var(--w);
      padding:14px 18px;
      font-weight:600;
      font-size:15px;
      background:var(--gris-900);
      color:#fff;
      border:none;
      border-radius:12px;
      box-shadow:var(--shadow-1);
      cursor:pointer;
      transition: transform var(--timing), background var(--timing), box-shadow var(--timing);
    }
    .payment-option:hover{
      background:var(--naranja-osc);
      transform:translateY(-1px);
      box-shadow:0 8px 22px rgba(243,156,18,.28)
    }
    .payment-option:active{ transform:translateY(0)}
    .payment-option:focus-visible{ outline:3px solid var(--amarillo-claro); outline-offset:2px}

    .payment-option:nth-child(1){ --w: 85% }
    .payment-option:nth-child(2){ --w: 65% }
    .payment-option:nth-child(3){ --w: 95% }

    /* Área formulario */
    .payment-wrap{
      grid-column:2/3;
      display:flex; align-items:center; justify-content:center;
      padding:50px;
      z-index:1;
    }
    .payment-container{
      width:min(950px, 100%);
      background:var(--blanco);
      border:1px solid var(--gris-200);
      border-radius:var(--radius-lg);
      box-shadow:var(--shadow-1);
      padding:28px;
    }
    #loading{font-size:18px; color:#666; display:none}
    #demo{display:none; width:100%}

    /* Modal */
    .modal{
      display:none; position:fixed; inset:0; z-index:1000;
      background:rgba(0,0,0,.55);
      backdrop-filter:blur(3px);
    }
    .modal-content{
      background:#fff; margin:6% auto; padding:26px;
      width:min(640px, 92%); border-radius:20px; position:relative;
      box-shadow:0 24px 60px rgba(0,0,0,.24);
    }
    .close{
      position:absolute; right:16px; top:12px; font-size:28px; color:#999; cursor:pointer; padding:2px 8px;
    }
    .close:hover{color:#000; background:#f3f3f3; border-radius:6px}

    /* Expandido */
    .stage.expandido::before{display:none}
    .stage.expandido .options{display:none}
    .stage.expandido .payment-wrap{grid-column:1/-1}
    .stage.expandido .payment-container{width:min(1080px, 96%)}

    /* Gateway botón interno */
    .payment-gateway-container .payment-methods-container .payment-method-wrapper .payment-method-form-wrapper .payment-method-submit-btn button{
      background-color:var(--gris-900);
    }
    .payment-gateway-container .payment-methods-container .payment-method-wrapper .payment-method-form-wrapper .payment-method-submit-btn button:hover{
      background-color:var(--naranja-osc);
    }

    @media(max-width:980px){
      .stage{grid-template-columns:1fr}
      .stage::before{inset:0; clip-path: polygon(0 0, 100% 0, 100% 42%, 0% 70%)}
      .options{margin:28px auto 10px; width:min(500px, 92%)}
      .payment-wrap{padding:24px 16px}
    }
  </style>
</head>
<body>
  <header onclick="volverAlInicio()">
    <img src="https://www.q10.com/Images/Landing/ImagenesLandingSafari/LogoQ10.png" alt="Q10">
  </header>

  <main class="stage">
    <section class="options" aria-labelledby="ops-title">
      <h2 id="ops-title">Opciones de Pago</h2>
      <p class="sub">Selecciona tu método preferido</p>
      <div class="stack">
        <button class="payment-option" onclick="abrirFormularioNormal(20000)">Formulario Normal</button>
        <button class="payment-option" onclick="abrirModal(100)">Pop&nbsp;Up</button>
        <button class="payment-option" onclick="abrirFormularioExpandido(1000)">Formulario Expandido</button>
      </div>
    </section>

    <section class="payment-wrap">
      <div class="payment-container">
        <div id="loading">Cargando pasarela...</div>
        <div id="demo"></div>
      </div>
    </section>
  </main>

  <!-- Modal -->
  <div id="paymentModal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="cerrarModal()">&times;</span>
      <h3 style="margin:4px 0 12px;color:#222">Pagar</h3>
      <div id="loadingModal">Cargando pasarela...</div>
      <div id="demoModal"></div>
    </div>
  </div>

  <script>
    function volverAlInicio(){window.location.reload();}
    function abrirFormularioExpandido(monto){
      const stage=document.querySelector('.stage');
      stage.classList.add('expandido');
      abrirFormularioNormal(monto);
    }
    async function obtenerAccessToken(){
      const r=await fetch("https://auth.wip.alignet.io/token",{
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify({
          action:"authorize",grant_type:"client_credentials",
          audience:"https://api.dev.alignet.io",
          client_id:"Lj6tRqRzDiw56PPdSOOAgogT2HnIjf",
          client_secret:"ijuVhdIETgcryjRRAJPGCd9nIu8HetTqDTIYe7VFcScgrprFY4Usu0e3H5KUPKeu",
          scope:"create:token post:charges offline_access"
        })
      }); return (await r.json()).access_token;
    }
    async function obtenerNonce(token){
      const r=await fetch("https://auth.wip.alignet.io/nonce",{
        method:"POST",
        headers:{"Content-Type":"application/json","Authorization":`Bearer ${token}`},
        body:JSON.stringify({
          action:"create.nonce",audience:"https://api.dev.alignet.io",
          client_id:"Lj6tRqRzDiw56PPdSOOAgogT2HnIjf",
          scope:"post:charges"
        })
      }); return (await r.json()).nonce;
    }
    async function cargarFormulario(target,loadingEl,monto){
      loadingEl.style.display="block"; target.style.display="none"; target.innerHTML="";
      try{
        const token=await obtenerAccessToken();
        const nonce=await obtenerNonce(token);
        const payload={action:"authorize",channel:"ecommerce",merchant_code:"453d8265-e01f-4ea5-9bfe-ca88b88e0beb",
          merchant_operation_number:Math.floor(Date.now()).toString().substring(7),
          payment_method:{},payment_details:{
            amount:Math.round(monto).toString(),currency:"604",
            billing:{first_name:"Cliente",last_name:"Q10",email:"cliente@q10.pe",
              phone:{country_code:"+51",subscriber:"999999999"},
              location:{line_1:"Av. Ejemplo 123",line_2:"",city:"Lima",state:"Lima",country:"Peru"}}
          }};
        const pf=new FlexPaymentForms({
          nonce,payload,settings:{show_close_button:false},
          display_settings:{methods:['CARD','YAPE','PAGOEFECTIVO','QR','BANK_TRANSFER', 'CUOTEALO'] }
        });
        pf.init(target,console.log,console.log,console.error);
        loadingEl.style.display="none"; target.style.display="block";
      }catch(e){console.error(e); alert("Error al cargar formulario."); loadingEl.style.display="none";}
    }
    function abrirFormularioNormal(monto){
      cargarFormulario(document.getElementById("demo"),document.getElementById("loading"),monto);
    }
    function abrirModal(monto){
      document.getElementById("paymentModal").style.display="block";
      cargarFormulario(document.getElementById("demoModal"),document.getElementById("loadingModal"),monto);
    }
    function cerrarModal(){
      document.getElementById("paymentModal").style.display="none";
      document.getElementById("demoModal").innerHTML="";
    }
  </script>
</body>
</html>
